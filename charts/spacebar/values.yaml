# Default values for Spacebar server.
# See https://docs.spacebar.chat/setup/server/ for configuration reference.

nameOverride: ""
fullnameOverride: ""

replicaCount: 1

# Spacebar server image. Official spacebarchat/server:latest may be unavailable on Docker Hub;
# using a community image by default. Override with your own image (e.g. build from
# https://github.com/spacebarchat/server) or spacebarchat/server if/when updated.
image:
  repository: ccgurley/spacebar-server
  tag: latest
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 3001

# Database: CloudNative-PG Cluster (when enabled), external URL, or SQLite (dev)
database:
  enabled: true
  # externalUrl: "postgresql://user:pass@host:5432/spacebar"  # use when database.enabled false

# CloudNative-PG: optional operator install + Cluster CR
postgresql:
  installOperator: false  # set true to install CNPG operator as subchart (e.g. for k3s)
  # When database.enabled true, a Cluster CR is created. Operator must be installed (here or separately).
  cluster:
    instances: 1
    storage:
      size: 1Gi

# Storage: default S3 for CDN (avatars, attachments, emoji, etc.). Chart does not create the bucket.
storage:
  provider: s3
  bucket: ""   # S3 bucket name (create in AWS; ensure IAM/IRSA has s3:GetObject, PutObject, DeleteObject, ListBucket)
  region: ""   # Bucket region (e.g. us-east-1)
  size: 1Gi    # used when provider: file and no existingClaim
  # For file storage override (e.g. local dev): provider: file, existingClaim: ""
  # storageClass: ""

# Existing secret for DATABASE URL, S3 credentials, JWT secret, etc. Keys: DATABASE, STORAGE_BUCKET, STORAGE_REGION, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, etc.
existingSecret: ""

# cert-manager: installed by default for Let's Encrypt TLS (set certManager.install: false if already installed)
certManager:
  install: true

# cert-manager subchart values (when certManager.install is true)
cert-manager:
  installCRDs: true
  crds:
    enabled: true
  # namespace: cert-manager  # optional: deploy to cert-manager namespace (create namespace first)

# Ingress: default Traefik (works on k3s and EKS)
ingress:
  enabled: true
  className: traefik
  host: spacebar.local
  tls: []
  #  - secretName: spacebar-tls
  #    hosts:
  #      - spacebar.example.com
  # Let's Encrypt via cert-manager (requires cert-manager installed in cluster)
  letsEncrypt:
    enabled: false
    email: ""              # required when enabled (ACME account)
    clusterIssuer: ""     # e.g. letsencrypt-prod; leave empty to create one per release
    createClusterIssuer: false  # set true to create a ClusterIssuer (uses HTTP-01 challenge)
  annotations: {}
  # Traefik: WebSockets work by default. For NGINX uncomment:
  # nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
  # nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"

# Public endpoints (injected into config for client discovery). Defaults derived from ingress.host.
config:
  apiEndpointPublic: ""   # e.g. https://spacebar.example.com/api/v9
  cdnEndpointPublic: ""   # e.g. https://spacebar.example.com
  gatewayEndpointPublic: "" # e.g. wss://spacebar.example.com
  # If empty, computed from ingress.host and ingress.tls

# Non-sensitive env for Spacebar (see https://docs.spacebar.chat/setup/server/configuration/env)
env: {}
  # LOG_REQUESTS: "-200"
  # WS_VERBOSE: "false"

resources: {}
  # limits:
  #   cpu: 500m
  #   memory: 512Mi
  # requests:
  #   cpu: 100m
  #   memory: 256Mi

nodeSelector: {}
tolerations: []
affinity: {}
