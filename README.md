# Spacebar Helm Chart

> **Note:** This repository and Helm chart were generated by Cursor AI from a plan. See the plan for design decisions and scope.

Kubernetes Helm chart for [Spacebar](https://spacebar.chat) (Discord-compatible chat, voice and video platform). Supports k3s and EKS, with optional [CloudNative-PG](https://cloudnative-pg.io/) PostgreSQL, default Traefik Ingress, and S3 CDN storage.

## Chart location

- **GitHub:** `https://github.com/<owner>/spacebarchart` (replace `<owner>` with your org or username)
- Chart path in repo: `charts/spacebar`
- **Helm repo (add this repo for install):** `https://<owner>.github.io/spacebarchart` — e.g. `https://khaleb7.github.io/spacebarchart` for the published chart.

## Install Spacebar (from Helm repo)

Add this chart repo and install (replace the repo URL with your fork if needed):

```bash
helm repo add spacebar https://khaleb7.github.io/spacebarchart
helm repo update
helm install spacebar spacebar/spacebar -n spacebar --create-namespace \
  --set ingress.host=spacebar.example.com \
  --set storage.bucket=my-bucket \
  --set storage.region=us-east-1
```

**If cert-manager is already installed in the cluster**, add `--set certManager.install=false` to avoid CRD ownership conflicts:

```bash
helm install spacebar spacebar/spacebar -n spacebar --create-namespace \
  --set certManager.install=false \
  --set ingress.host=spacebar.example.com \
  --set storage.bucket=my-bucket \
  --set storage.region=us-east-1
```

For your own fork, use `https://<owner>.github.io/spacebarchart` instead. Ensure GitHub Pages is enabled (Settings → Pages → Source: `gh-pages`) so the repo serves `index.yaml`.

## Quick start (from source)

```bash
# Clone the chart repo (or use your fork)
git clone https://github.com/<owner>/spacebarchart
cd spacebarchart

# Fetch dependencies (cert-manager is included by default; optional CNPG)
helm dependency update ./charts/spacebar

# Optional: install CloudNative-PG operator separately (or set postgresql.installOperator=true)
# helm repo add cnpg https://cloudnative-pg.github.io/charts
# helm install cnpg cnpg/cloudnative-pg -n cnpg-system --create-namespace

# Install Spacebar from the chart in this repo (includes cert-manager)
helm install spacebar ./charts/spacebar -n spacebar --create-namespace \
  --set ingress.host=spacebar.example.com \
  --set storage.bucket=my-bucket \
  --set storage.region=us-east-1
```

**S3 (CDN):** Spacebar stores uploads (avatars, attachments, emoji) in an S3 bucket. Set `storage.bucket` and `storage.region`; create the bucket and grant the Spacebar workload IAM access (IRSA on EKS, or a secret with `AWS_ACCESS_KEY_ID`/`AWS_SECRET_ACCESS_KEY`). See [charts/spacebar/README.md](charts/spacebar/README.md) for S3 configuration and implications.

**Let's Encrypt (Traefik):** cert-manager is installed by default. Set `ingress.letsEncrypt.enabled=true`, `ingress.letsEncrypt.email`, and optionally `ingress.letsEncrypt.createClusterIssuer=true` to get TLS certs automatically. Set `certManager.install: false` if you already have cert-manager. See [charts/spacebar/README.md](charts/spacebar/README.md) for full configuration.

## Terraform (EKS)

See [examples/eks](examples/eks) for a minimal EKS + Spacebar Terraform example using `helm_release`.

## Links

- [Spacebar](https://spacebar.chat) / [GitHub](https://github.com/spacebarchat)
- [Spacebar docs](https://docs.spacebar.chat/setup/server/)
- [CloudNative-PG](https://cloudnative-pg.io/)
