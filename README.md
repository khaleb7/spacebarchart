# Spacebar Helm Chart

> **Note:** This repository and Helm chart were generated by Cursor AI from a plan. See the plan for design decisions and scope.

Kubernetes Helm chart for [Spacebar](https://spacebar.chat) (Discord-compatible chat, voice and video platform). Supports k3s and EKS, with optional [CloudNative-PG](https://cloudnative-pg.io/) PostgreSQL, default Traefik Ingress, and S3 CDN storage.

## Chart location

- **GitHub:** `https://github.com/<owner>/spacebarchart` (replace `<owner>` with your org or username)
- Chart path in repo: `charts/spacebar`
- **Helm repo (after enabling GitHub Pages):** `https://<owner>.github.io/spacebarchart`

## Install from GitHub (Helm repo)

After the chart is published (push to `main` runs the [release workflow](.github/workflows/release-charts.yml) and updates the `gh-pages` branch):

1. **Enable GitHub Pages** in the repo: **Settings → Pages → Source:** `gh-pages` branch (root). The workflow creates/updates `gh-pages` automatically.
2. Add the Helm repo and install:

```bash
helm repo add spacebar https://<owner>.github.io/spacebarchart
helm repo update
helm install spacebar spacebar/spacebar -n spacebar --create-namespace \
  --set ingress.host=spacebar.example.com \
  --set storage.bucket=my-bucket \
  --set storage.region=us-east-1
```

Replace `<owner>` with your GitHub org or username.

## Quick start (from source)

```bash
# Clone the chart repo (or use your fork)
git clone https://github.com/<owner>/spacebarchart
cd spacebarchart

# Fetch dependencies (cert-manager is included by default; optional CNPG)
helm dependency update ./charts/spacebar

# Optional: install CloudNative-PG operator separately (or set postgresql.installOperator=true)
# helm repo add cnpg https://cloudnative-pg.github.io/charts
# helm install cnpg cnpg/cloudnative-pg -n cnpg-system --create-namespace

# Install Spacebar from the chart in this repo (includes cert-manager)
helm install spacebar ./charts/spacebar -n spacebar --create-namespace \
  --set ingress.host=spacebar.example.com \
  --set storage.bucket=my-bucket \
  --set storage.region=us-east-1
```

Provide S3 credentials via a Kubernetes secret (or IRSA on EKS) and set `existingSecret` if needed.

**Let's Encrypt (Traefik):** cert-manager is installed by default. Set `ingress.letsEncrypt.enabled=true`, `ingress.letsEncrypt.email`, and optionally `ingress.letsEncrypt.createClusterIssuer=true` to get TLS certs automatically. Set `certManager.install: false` if you already have cert-manager. See [charts/spacebar/README.md](charts/spacebar/README.md) for full configuration.

## Terraform (EKS)

See [examples/eks](examples/eks) for a minimal EKS + Spacebar Terraform example using `helm_release`.

## Publishing the chart repo (maintainers)

1. Enable **GitHub Pages**: repo **Settings → Pages → Source:** `gh-pages` branch (root).
2. Push to `main` (or run the workflow manually). [release-charts.yml](.github/workflows/release-charts.yml) runs [chart-releaser-action](https://github.com/helm/chart-releaser-action): it packages the chart, creates a GitHub Release with the `.tgz`, and updates `gh-pages` with `index.yaml`. New versions are published when `charts/spacebar/Chart.yaml` version is bumped.
3. The Helm repo URL is `https://<owner>.github.io/spacebarchart`.

## Links

- [Spacebar](https://spacebar.chat) / [GitHub](https://github.com/spacebarchat)
- [Spacebar docs](https://docs.spacebar.chat/setup/server/)
- [CloudNative-PG](https://cloudnative-pg.io/)
